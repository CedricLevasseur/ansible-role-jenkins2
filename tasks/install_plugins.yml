---
# included file

- name: Jenkins CLI
  get_url:
    url: "http://localhost:{{ jenkins2_http_port }}{{ jenkins2_context_path | default('') }}/jnlpJars/jenkins-cli.jar"
    dest: /tmp/jenkins-cli.jar
    owner: root
    group: root
    mode: 0444

- name: Groovy Scripts
  template:
    src: "{{ item }}"
    dest: "/tmp/{{ item }}"
    owner: root
    group: root
    mode: 0444
  with_items:
    - cli_user_registration.groovy
    # - proxy_configuration.groovy
    # - git_plugin_configuration.groovy

- name: CLI User Registration
  shell: "java -jar /tmp/jenkins-cli.jar -s http://localhost:{{ jenkins2_http_port }}{{ jenkins2_context_path | default('') }} groovy /tmp/cli_user_registration.groovy"

- name: Plugins Installation
  shell: "java -jar /tmp/jenkins-cli.jar -s http://localhost:{{ jenkins2_http_port }}{{ jenkins2_context_path | default('') }} install-plugin {{ item }}"
  with_items:
    - "{{ jenkins2_suggested_plugins }}"
    - "{{ jenkins2_plugins }}"
  notify:
    - Restart Jenkins
